# 聊天记录超级管理器 - 全面测试用例

> 像"工程师去酒吧点炒饭"一样考虑所有边界情况和异常场景

## 🚀 测试环境准备

### 基础环境检查
- [ ] SillyTavern正常运行
- [ ] 扩展正确加载，在Extensions菜单中可见
- [ ] 浏览器控制台无错误信息
- [ ] 插件主开关可以正常切换

### 测试数据准备
- [ ] 创建包含不同类型消息的测试聊天（用户消息、AI消息、系统消息）
- [ ] 准备不同格式的测试文件（txt、json、md等）
- [ ] 创建测试世界信息条目
- [ ] 准备包含各种标签的测试内容

---

## 📋 核心功能测试

### 1. 主开关控制测试

#### 1.1 主开关启用/禁用
- [ ] **场景1**: 禁用主开关，确认所有子功能不可用
- [ ] **场景2**: 启用主开关，确认所有子功能恢复
- [ ] **场景3**: 主开关禁用状态下点击预览/导出/向量化按钮，应显示警告
- [ ] **场景4**: 页面刷新后主开关状态正确保存

#### 1.2 边界测试
- [ ] **异常**: 网络断开时切换主开关
- [ ] **异常**: 快速连续点击主开关
- [ ] **异常**: 在向量化进行中禁用主开关

### 2. 向量化源配置测试

#### 2.1 基本配置
- [ ] **Transformers**: 本地模型名称输入和验证
- [ ] **vLLM**: URL和模型配置
- [ ] **Ollama**: URL、模型配置、Keep选项
- [ ] **WebLLM**: 基本配置
- [ ] **OpenAI**: API密钥和模型配置
- [ ] **Cohere**: API密钥和模型配置

#### 2.2 参数配置
- [ ] **块大小**: 输入100-10000范围内外的值
- [ ] **重叠百分比**: 0%默认值，输入0-50范围内外的值
- [ ] **分数阈值**: 0-1范围内外的值测试
- [ ] **自定义块分隔符**: 空值、特殊字符、长文本

#### 2.3 边界测试
- [ ] **异常**: 输入负数、非数字、超大数值
- [ ] **异常**: 输入包含HTML/脚本的恶意内容
- [ ] **异常**: API密钥包含特殊字符
- [ ] **异常**: URL格式错误或无法访问

### 3. 内容选择测试

#### 3.1 聊天消息选择
- [ ] **基本选择**: 选择用户消息、AI消息、混合选择
- [ ] **范围选择**: 从消息#0开始，到消息#-1结束
- [ ] **范围选择**: 指定具体范围（如#5到#15）
- [ ] **隐藏消息**: 包含/排除隐藏消息选项

#### 3.2 隐藏消息管理
- [ ] **隐藏范围**: 选择范围并隐藏消息
- [ ] **显示范围**: 取消隐藏指定范围的消息
- [ ] **查看隐藏**: 显示当前所有隐藏消息列表
- [ ] **楼层显示**: 隐藏消息的楼层范围正确显示

#### 3.3 标签提取规则
- [ ] **添加规则**: 创建简单标签规则
- [ ] **复杂标签**: 创建包含排除语法的规则（tag1,tag2 - exclude1,exclude2）
- [ ] **HTML标签**: 测试<content>、<details>等HTML格式标签
- [ ] **正则表达式**: 测试包含正则的复杂规则
- [ ] **标签扫描**: 扫描当前内容中存在的标签
- [ ] **快速排除CoT**: 一键添加排除HTML注释的规则

#### 3.4 内容过滤黑名单
- [ ] **基本过滤**: 添加中英文关键词
- [ ] **多行输入**: 每行一个关键词
- [ ] **特殊字符**: 包含符号、表情的关键词
- [ ] **过滤效果**: 确认包含黑名单词汇的内容被跳过

#### 3.5 文件选择
- [ ] **文件列表**: 刷新并显示所有可用文件
- [ ] **文件选择**: 单选、多选不同文件
- [ ] **文件信息**: 显示文件名、大小等信息
- [ ] **文件类型**: 测试不同格式文件的处理

#### 3.6 世界信息选择
- [ ] **世界信息列表**: 刷新并显示所有世界信息
- [ ] **按世界分组**: 不同世界的条目正确分组
- [ ] **条目选择**: 单选、多选不同条目
- [ ] **条目信息**: 显示注释、关键词等信息

#### 3.7 边界测试
- [ ] **异常**: 空聊天记录时的选择
- [ ] **异常**: 消息范围超出实际范围
- [ ] **异常**: 标签规则语法错误
- [ ] **异常**: 文件不存在或无法访问
- [ ] **异常**: 世界信息数据损坏

### 4. 预览功能测试

#### 4.1 全局预览
- [ ] **内容显示**: 三列布局（文件、世界信息、聊天记录）
- [ ] **楼层信息**: 聊天记录开头显示"包含楼层：x-x, x"
- [ ] **处理内容**: 默认显示处理后的内容
- [ ] **原始内容**: 勾选"显示原始内容"后显示标签筛选后的内容
- [ ] **统计信息**: 显示内容处理统计（原始提取、排除、黑名单过滤）

#### 4.2 任务预览
- [ ] **任务内容**: 显示特定任务包含的实际内容
- [ ] **一致性**: 与全局预览保持相同的布局和样式
- [ ] **楼层信息**: 正确显示任务包含的楼层范围
- [ ] **内容切换**: 原始内容选项同样生效

#### 4.3 数据准确性
- [ ] **文件数据**: 文件名、大小正确显示
- [ ] **世界信息数据**: 世界名、注释、关键词正确显示
- [ ] **聊天数据**: 消息索引、发送者、内容正确显示
- [ ] **楼层合并**: 相邻楼层正确合并显示（0-3, 5, 7-9）

#### 4.4 边界测试
- [ ] **异常**: 空内容时的预览
- [ ] **异常**: 内容包含大量HTML标签
- [ ] **异常**: 极长的消息内容
- [ ] **异常**: 特殊字符和表情符号处理

### 5. 任务管理测试

#### 5.1 任务创建
- [ ] **手动向量化**: 点击向量化按钮创建任务
- [ ] **自动向量化**: 内容变更时自动创建任务
- [ ] **任务命名**: 智能命名显示正确格式
  - 单一来源: "楼层 #0-3 5条"、"世界书 5条目"、"文件 3个"
  - 多来源: "10层楼 5条世界书 3个文件"

#### 5.2 任务操作
- [ ] **启用/禁用**: 勾选框控制任务状态
- [ ] **重命名**: 点击重命名按钮修改任务名称
- [ ] **删除**: 删除任务并确认
- [ ] **预览**: 查看任务包含的具体内容

#### 5.3 任务持久化
- [ ] **保存**: 任务状态正确保存到设置
- [ ] **恢复**: 页面刷新后任务列表正确恢复
- [ ] **聊天切换**: 切换不同聊天时显示对应任务

#### 5.4 边界测试
- [ ] **异常**: 删除正在使用的任务
- [ ] **异常**: 重命名为空名称或超长名称
- [ ] **异常**: 大量任务时的性能
- [ ] **异常**: 任务数据损坏时的处理

### 6. 向量化过程测试

#### 6.1 正常流程
- [ ] **进度显示**: 向量化过程中显示进度条
- [ ] **状态切换**: 向量化按钮变为中断按钮
- [ ] **完成提示**: 向量化完成后显示成功信息
- [ ] **自动隐藏**: 进度条自动隐藏

#### 6.2 中断功能
- [ ] **中断向量化**: 点击中断按钮停止进程
- [ ] **状态恢复**: 中断后按钮状态正确恢复
- [ ] **清理**: 中断后正确清理临时状态

#### 6.3 错误处理
- [ ] **网络错误**: 向量化服务不可用时的处理
- [ ] **API错误**: 错误的API密钥或参数
- [ ] **内容错误**: 空内容或格式错误的内容
- [ ] **超时处理**: 长时间无响应的处理

#### 6.4 边界测试
- [ ] **异常**: 大量内容向量化时的性能
- [ ] **异常**: 快速连续点击向量化
- [ ] **异常**: 向量化过程中刷新页面
- [ ] **异常**: 向量化过程中切换聊天

### 7. Rerank功能测试

#### 7.1 基本配置
- [ ] **启用/禁用**: Rerank开关控制
- [ ] **API配置**: URL、密钥、模型配置
- [ ] **参数配置**: Top N、混合权重设置
- [ ] **通知设置**: 成功通知开关

#### 7.2 功能验证
- [ ] **重排序**: 查询结果经过Rerank重新排序
- [ ] **混合评分**: Rerank分数与原始分数正确混合
- [ ] **通知显示**: 成功时显示通知（如果启用）

#### 7.3 边界测试
- [ ] **异常**: Rerank服务不可用
- [ ] **异常**: 错误的API配置
- [ ] **异常**: 极端的参数值
- [ ] **异常**: 网络超时或中断

### 8. 注入设置测试

#### 8.1 模板配置
- [ ] **模板编辑**: 修改注入模板内容
- [ ] **占位符**: {{text}}占位符正确替换
- [ ] **特殊字符**: 模板中包含特殊字符和HTML

#### 8.2 注入位置
- [ ] **主提示前**: 内容注入到主提示之前
- [ ] **主提示后**: 内容注入到主提示之后
- [ ] **聊天内深度**: 指定深度和角色的注入

#### 8.3 内容标签
- [ ] **标签配置**: 聊天记录、世界信息、文件的标签
- [ ] **标签应用**: 不同类型内容使用对应标签
- [ ] **标签显示**: 注入内容中正确显示标签

#### 8.4 边界测试
- [ ] **异常**: 模板语法错误
- [ ] **异常**: 深度值超出范围
- [ ] **异常**: 空模板或超长模板

### 9. 导出功能测试

#### 9.1 基本导出
- [ ] **文件生成**: 点击导出按钮生成文件
- [ ] **文件格式**: 导出的JSON格式正确
- [ ] **文件内容**: 包含所有向量化数据
- [ ] **文件下载**: 浏览器正确下载文件

#### 9.2 数据完整性
- [ ] **向量数据**: 所有向量正确包含
- [ ] **元数据**: 来源、时间戳等信息完整
- [ ] **设置信息**: 相关设置一并导出

#### 9.3 边界测试
- [ ] **异常**: 空数据时的导出
- [ ] **异常**: 大量数据时的导出性能
- [ ] **异常**: 浏览器不支持下载时的处理

---

## 🎯 UI/UX 测试

### 10. 界面交互测试

#### 10.1 折叠展开
- [ ] **主折叠**: 整个插件的折叠展开
- [ ] **子区块折叠**: 向量化设置、Rerank设置等子区块
- [ ] **内容选择折叠**: 内容选择大块的折叠
- [ ] **任务列表折叠**: 向量化任务区块的折叠
- [ ] **状态保存**: 折叠状态的记忆（如果支持）

#### 10.2 响应式布局
- [ ] **宽屏**: 大分辨率下的显示效果
- [ ] **窄屏**: 小分辨率下的自适应
- [ ] **预览窗口**: 弹窗的响应式表现
- [ ] **长内容**: 超长文本的处理和滚动

#### 10.3 交互反馈
- [ ] **按钮状态**: 禁用、加载、悬停状态
- [ ] **进度指示**: 向量化过程中的视觉反馈
- [ ] **错误提示**: 错误信息的显示方式
- [ ] **成功提示**: 操作成功的确认信息

#### 10.4 键盘操作
- [ ] **Tab导航**: 键盘Tab键在表单间的导航
- [ ] **Enter确认**: 回车键在适当位置的确认操作
- [ ] **Esc取消**: ESC键关闭弹窗或取消操作

### 11. 兼容性测试

#### 11.1 浏览器兼容
- [ ] **Chrome**: 最新版本和旧版本
- [ ] **Firefox**: 最新版本和旧版本
- [ ] **Safari**: 最新版本测试
- [ ] **Edge**: 最新版本测试

#### 11.2 SillyTavern版本兼容
- [ ] **最新版**: 最新稳定版SillyTavern
- [ ] **历史版**: 较旧版本的兼容性
- [ ] **API变更**: SillyTavern API变更的影响

#### 11.3 其他扩展兼容
- [ ] **扩展冲突**: 与其他扩展的兼容性
- [ ] **资源竞争**: 多个扩展同时运行
- [ ] **样式冲突**: CSS样式的冲突问题

---

## 🚨 边界条件与异常测试

### 12. 极端数据测试

#### 12.1 大数据量
- [ ] **大聊天**: 包含数千条消息的聊天
- [ ] **大文件**: 体积很大的文件处理
- [ ] **大量任务**: 创建数百个向量化任务
- [ ] **大量世界信息**: 处理大量世界信息条目

#### 12.2 空数据测试
- [ ] **空聊天**: 没有消息的聊天
- [ ] **空选择**: 未选择任何内容时的操作
- [ ] **空文件**: 空内容文件的处理
- [ ] **空世界信息**: 没有世界信息时的处理

#### 12.3 特殊字符测试
- [ ] **Unicode**: 各种语言文字和特殊符号
- [ ] **表情符号**: Emoji和特殊表情的处理
- [ ] **HTML实体**: HTML特殊字符的转义
- [ ] **脚本注入**: 防止XSS攻击的测试

### 13. 并发操作测试

#### 13.1 同时操作
- [ ] **多窗口**: 多个SillyTavern窗口同时操作
- [ ] **快速点击**: 快速连续点击各种按钮
- [ ] **操作冲突**: 同时进行多个向量化操作

#### 13.2 状态一致性
- [ ] **设置同步**: 多窗口间设置的同步
- [ ] **任务状态**: 任务状态在不同窗口的一致性
- [ ] **数据一致性**: 向量数据的一致性保证

### 14. 网络异常测试

#### 14.1 网络中断
- [ ] **离线模式**: 网络完全断开时的行为
- [ ] **网络恢复**: 网络恢复后的自动重连
- [ ] **超时处理**: 网络请求超时的处理

#### 14.2 API异常
- [ ] **服务器错误**: 向量化服务返回5xx错误
- [ ] **认证失败**: API密钥错误或过期
- [ ] **限流**: API调用频率限制
- [ ] **格式错误**: API返回格式异常的数据

### 15. 内存和性能测试

#### 15.1 内存使用
- [ ] **内存泄漏**: 长时间使用后的内存情况
- [ ] **大数据内存**: 处理大量数据时的内存占用
- [ ] **垃圾回收**: 操作完成后的内存释放

#### 15.2 性能表现
- [ ] **响应时间**: 各种操作的响应速度
- [ ] **渲染性能**: 大量内容时的界面渲染
- [ ] **后台任务**: 后台处理对界面响应的影响

---

## 🔍 回归测试

### 16. 核心功能回归

#### 16.1 基础流程
- [ ] **完整流程1**: 新用户首次使用的完整流程
- [ ] **完整流程2**: 配置 → 选择内容 → 预览 → 向量化 → 查询
- [ ] **完整流程3**: 创建任务 → 管理任务 → 导出数据

#### 16.2 配置变更影响
- [ ] **设置修改**: 修改设置后对现有任务的影响
- [ ] **源切换**: 切换向量化源后的影响
- [ ] **参数调整**: 调整参数后的向量化结果

### 17. 数据迁移测试

#### 17.1 旧版本兼容
- [ ] **旧任务格式**: 旧版本任务数据的兼容
- [ ] **设置迁移**: 旧版本设置的自动迁移
- [ ] **数据完整性**: 迁移后数据的完整性

#### 17.2 版本升级
- [ ] **无缝升级**: 插件更新后的平滑过渡
- [ ] **向后兼容**: 新版本对旧数据的支持
- [ ] **功能保持**: 升级后原有功能的正常运行

---

## 📊 测试报告模板

### 测试执行记录

```markdown
## 测试执行日期: [日期]
## 测试环境: 
- SillyTavern版本: [版本]
- 浏览器: [浏览器及版本]
- 插件版本: [版本]

## 测试结果总览
- 总测试用例数: [数量]
- 通过用例数: [数量]
- 失败用例数: [数量]
- 阻塞用例数: [数量]

## 关键问题列表
1. [问题描述] - 严重度: [高/中/低] - 状态: [待修复/已修复]
2. [问题描述] - 严重度: [高/中/低] - 状态: [待修复/已修复]

## 性能测试结果
- 大数据处理: [结果]
- 内存使用: [结果]
- 响应时间: [结果]

## 兼容性测试结果
- 浏览器兼容性: [结果]
- SillyTavern版本兼容性: [结果]
- 扩展兼容性: [结果]

## 建议和改进点
1. [建议1]
2. [建议2]
3. [建议3]
```

---

## 🎯 测试优先级分级

### P0 (阻塞级) - 必须通过
- 主开关功能
- 基本向量化流程
- 任务创建和管理
- 数据持久化

### P1 (高优先级) - 应该通过
- 所有UI交互
- 预览功能
- 导出功能
- 错误处理

### P2 (中优先级) - 最好通过
- 高级功能 (Rerank, 复杂标签)
- 性能优化
- 边界条件

### P3 (低优先级) - 可以接受失败
- 极端边界情况
- 罕见的兼容性问题
- 非关键的UI细节

---

**测试座右铭**: "如果用户能想到的操作方式，测试就要覆盖到；如果用户想不到的操作方式，更要测试到。" 

像工程师点炒饭一样，考虑所有可能的情况：
- "我要一份炒饭" ✓
- "我要一份不要米的炒饭" (边界测试)
- "我要一份炒饭，但是要分成两盘装" (特殊需求)
- "我同时要10份炒饭" (压力测试)
- "我要一份炒饭，但是厨房没有米了" (异常情况)
- "我点了炒饭但是突然改主意了" (操作中断)
- "我用外语点炒饭" (国际化测试)
- "我点炒饭的时候停电了" (环境异常)